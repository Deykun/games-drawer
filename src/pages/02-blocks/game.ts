import { Block } from './objects/block'

let canvas = undefined as unknown as HTMLCanvasElement;
let ctx = undefined as unknown as CanvasRenderingContext2D;

const mapLayers: string[][][] = [
  [
    ['0000', '0000', '1001'],
  ],
  [
    ['0000', '0000', '1111'],
  ],
  [
    ['0000', '0000', '1111'],
  ],
  [
    ['0000', '0100', '1111', '1111', '0001', '0100', '1111', '0001', '0000', '0000'],
    ['0000', '1100', '1111', '1001', '0000', '1100', '1001', '0000', '0000', '0000'],
    ['0000', '0000', '1100', '1001', '0000', '0000', '1000', '0000', '0000', '0000'],
    ['0000', '0000', '1000', '0000', '0000', '0000', '0000', '0000', '0000', '0000'],
  ],
  [
    ['0000', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1001'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1001'],
    ['1100', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1100', '1111', '1111', '1111', '1111', '1111', '1111', '1001'],
    ['0000', '1100', '1111', '1111', '1111', '1111', '1111', '1001'],
    ['0000', '1000', '1000', '1000', '1000', '1000', '1000', '0000'],
  ],
  [
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
    ['1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111', '1111'],
  ]
].reverse();

const drawMap = () => {
  mapLayers.forEach((z, zIndex) => {
    z.forEach((y, yIndex) => {
      y.forEach((type, xIndex) => {
        const block = new Block({ canvas, ctx, type, z: zIndex, x: xIndex, y: yIndex });
        block.draw();
      });
    });
  })
}

const renderFrame = () => {
  window.requestAnimationFrame(renderFrame);

  drawMap();
}


export const runGame = ({ canvas: gameCanvas, ctx: gameCtx }: { canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D }) => {
  canvas = gameCanvas;
  ctx = gameCtx;
  ctx.imageSmoothingEnabled = false;


  renderFrame();
};
